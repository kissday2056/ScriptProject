<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>아 제발좀 한번에 되라</title>
    <script src="jquery-3.5.1.min.js"></script>
    <style>
      /*h1 글/*/
      h1 {
      text-align: center;
      }
    /*이건 안에 내용 입력*/
      input {
        width: 100px;
        padding: 10px;
        color: gray;
        color: black;
      }
      /*h2 글/*/
      h2 {
        text-align: center;
      }
      /*이건 div로 묶은거 */
      div#ffff {
        position: absolute;
        left:42%;
        top:20%;
      }
      div#qqqq {
        position: absolute;
        left:39.3%;
        top:25%;
      }
      p#pp {
        text-align: center;
      }
      div#wwww {
        position: absolute;
        left: 38.5%;
        top: 34%;
      }
      div#eeee {
        position: absolute;
        left: 50%;
        top: 37%;
      }
      th, td{
        border: 1px solid gray;
        width: 200px;
        padding: 5px;
      }
      th{
        background-color: gray;
      }
      table {
        position: absolute;
        left:40%;
        top:40%;
      }
      h1#ming{
        position: absolute;
        left:40%;
        top:41%;
      }
      </style>
  </head>
  <body>
    <h1>스크립트 프로젝트</h1>
    <!--금액 표시 영역이랑 금액 설정 버튼 키보드 어떤 값도 입력 안되게 -->
    <h2 id = qwe123>201620903 박민규</h2>
    <h2 class = 'input_text2()'></h2>
    <div id="ffff">
    <p>Amount: <input type="text" id="first" value="0" style="background-color: skyblue; text-align: right" onkeydown="input(event)"> <input type ='button' style = "text-align: center" onclick='input_text()' value='Check'/></p>
    </div>
    <!--휴대폰번호 표시 영역 -->
    <div id="qqqq">
    <p>Phone Number: <input type="text" id="Second" value="010-" style="background-color: blue" onkeydown="input(event)" > <input type ='button' style = "text-align: center" id="saveBtn" value='Save'/> <input type ='button' style = "text-align: center" id="cancelBtn" value='Cancel'/></p>
    <hr>
    </div>
    <hr>
    <!--숫자패드-->
    <div id="wwww">
    <button id="btn0" style = "text-align: center; padding:5px; width:40px" disabled="disabled">010</button>
    <button id="btn1" style = "text-align: center; padding:5px; width:25px" onclick='send(0)'>0</button>
    <button id="btn1" style = "text-align: center; padding:5px; width:25px" onclick='send(1)'>1</button>
    <button id="btn2" style = "text-align: center; padding:5px; width:25px" onclick='send(2)'>2</button>
    <button id="btn3" style = "text-align: center; padding:5px; width:25px" onclick='send(3)'>3</button>
    <button id="btn4" style = "text-align: center; padding:5px; width:25px" onclick='send(4)'>4</button>
    <button id="btn5" style = "text-align: center; padding:5px; width:25px" onclick='send(5)'>5</button>
    <button id="btn6" style = "text-align: center; padding:5px; width:25px" onclick='send(6)'>6</button>
    <button id="btn7" style = "text-align: center; padding:5px; width:25px" onclick='send(7)'>7</button>
    <button id="btn8" style = "text-align: center; padding:5px; width:25px" onclick='send(8)'>8</button>
    <button id="btn9" style = "text-align: center; padding:5px; width:25px" onclick='send(9)'>9</button>
    <button id="btnX" style = "text-align: center; padding:5px; width:25px; background-color: pink" onclick='delet()'>X</button>
    <button id="btnC" input type = "Second" value = "010-"style = "text-align: center; padding:5px; width:25px; background-color: skyblue" onclick='reset()'>C</button>
    <button id="showAll" style = "text-align: center" onclick='add_row()'>ShowAll</button>
    <button id="deletRow1" style = "text-align: center" onclick='delete_row()'>deletRow</button>
    <hr>
    </div>
    <table>
      <thead>
        <th>사용자</th>
        <th>적립횟수</th>
      </thead>
      <tbody id="my-Tbody">
      </tbody>
    </table>
    <script>
    //금액설정 버튼임 1,000 ~ 100,000원 사이 금액 표시 (천원단위), 천원다위마다 콤마(,) 표시
    function input_text() { //클릭시 값 입력되게
       var iiii = Math.floor(Math.random() *100) * 1000;
        document.getElementById("first").value = iiii.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    //키보드 입력안되게 설정하기 함수로 한 이유는 다른설정도 할 수 도 있으니깐 ;
    function input(event) {
      event.preventDefault();
    }
    //반환해서 숫자를 + 하도록 했음
    //문자열 길이 확인후 - 대입 했음
    //최대로 입력했는데도 더 번호 입력하면 경고차 뛰우게 했음
    function send(data) {
      var qwer = document.getElementById("Second");
      if(qwer.value.length ===8) {
        Second.value = Second.value+"-";
      }
      if(qwer.value.length ===13) {
        return alert('휴대폰번호를 최대로 입력하셨습니다.');
      }
      Second.value = Second.value +data;
    }
    //X버튼 뒷자리 1개씩 삭제하게
    //최대 13자리니까 그 이하일때 조건 했음 머리 터질뻔;;이게 젤 어렵네slice 쓰는법을 몰라가지고;
    function delet() {
      var qwerr = document.getElementById("Second");
      if(qwerr.value.length <=13) {
        document.getElementById("Second").value = qwerr.value.slice(0,-1);
      }
    }
    //초기화 버튼 C 구현하기
    function reset() {
      var resett = "010-";
      document.getElementById("Second").value = resett;
    }
    //데이터 저장하기
    $(function(){
      //저장버튼
      $('#saveBtn').click(function(){
        if(!window.localStorage) {
          //브라우저 지원 확인
          alert("현재 브라우저는 지원하지 않습니다.");
          return false;
        }
        //저장하기
        let v = parseInt(document.getElementById("first").value.replace(",",""));
        if(localStorage.getItem(document.getElementById("Second").value) === null){
        localStorage.setItem(document.getElementById("Second").value, parseInt(document.getElementById("first").value.replace(",","")));
      } else {
      let key = parseInt(localStorage.getItem(document.getElementById("Second").value));
        let sum = parseInt(v + key);
       localStorage.setItem(document.getElementById("Second").value, sum);
     }
     document.getElementById("qwe123").innerHTML="사용자 : "+document.getElementById("Second").value+"<br>"+"사용금액: "+localStorage.getItem(document.getElementById("Second").value);
      });
      //삭제버튼
      $('#cancelBtn').click(function(){
        if(!window.localStorage) {
          //브라우저 지원 확인
          alert("현재 브라우저는 지원하지 않습니다.");
          return false;
        }
        //저장하기
        let v = parseInt(document.getElementById("first").value.replace(",",""));
        if(localStorage.getItem(document.getElementById("Second").value) === null){
          return false;
        //localStorage.setItem(document.getElementById("Second").value, parseInt(document.getElementById("first").value.replace(",","")));
      } else {
      let key = parseInt(localStorage.getItem(document.getElementById("Second").value));
        let sum = parseInt(key-v);
       localStorage.setItem(document.getElementById("Second").value, sum);
     }
     document.getElementById("qwe123").innerHTML="사용자 : "+document.getElementById("Second").value +"<br>" +"사용금액: "+localStorage.getItem(document.getElementById("Second").value);
      });
    })
    //행 추가 버튼
    function add_row() {
      for(let i=0; i<localStorage.length; i++) {
        let key = localStorage.key(i);
        var my_tbody = document.getElementById("my-Tbody");
        var row = my_tbody.insertRow( my_tbody.rows.length );
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        cell1.innerHTML= `${key}`;
        cell2.innerHTML=`${localStorage.getItem(key)}`;
              }
        }
    //행 삭제 버튼
      function delete_row() {
        var my_tbody = document.getElementById('my-Tbody');
        my_tbody.deleteRow( my_tbody.rows.length-1 ); // 하단부터 삭제
      }

    </script>
  </body>
</html>
